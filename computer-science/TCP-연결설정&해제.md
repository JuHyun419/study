## π“ TCPμ μ—°κ²° μ„¤μ •(3-way Handshake) λ° ν•΄μ (4-way Handshake) κ³Όμ •

### TCPμ μ—°κ²° μ„¤μ •(3-way Handshake)
  - TCP ν†µμ‹ μ„ μ΄μ©ν•΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ„ν•΄ 3-way Handshakeλ΅ λ„¤νΈμ›ν¬ μ—°κ²°μ„ μ„¤μ •(Connection Establish)ν•λ” κ³Όμ •
  - ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•  μ¤€λΉ„κ°€ λμ—λ‹¤λ” κ²ƒμ„ λ³΄μ¥ν•κ³ , μ‹¤μ  λ°μ΄ν„° ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§€κΈ° μ „μ— ν• μ½μ΄ λ‹¤λ¥Έ μ½μ— μ¤€λΉ„λμ—λ‹¤λ” κ²ƒμ„ μ• μ μλ„λ΅ ν•¨(μ‹ λΆ°μ„±)
    - μ¦‰, TCP/IP ν”„λ΅ν† μ½μ„ μ΄μ©ν•΄ ν†µμ‹ μ„ ν•λ” μ‘μ© ν”„λ΅κ·Έλ¨μ΄ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— μ •ν™•ν• μ „μ†΅(μ‹ λΆ°μ„±)μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μƒλ€λ°© μ»΄ν“¨ν„°μ™€ μ‚¬μ „μ— μ„Έμ…μ„ μλ¦½ν•λ” κ³Όμ •
  - ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ μƒλ€νΈμ— λ€ν• μ΄κΈ°μ μμ°¨ μΌλ ¨λ²νΈλ¥Ό μ–»μ„ μ μμ

![image](https://user-images.githubusercontent.com/50076031/123729705-61c48b80-d8d0-11eb-91d6-3de3e9c1d06a.png)


<br>

### 3-way Handshake μ μ°¨ (A: ν΄λΌμ΄μ–ΈνΈ, B: μ„λ²„)
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ ‘μ†μ„ μ”μ²­ν•λ” *SYN* ν¨ν‚·μ„ μ „μ†΅
    - SYN ν”λκ·Έ λΉ„νΈλ¥Ό 1λ΅ μ„¤μ •ν•κ³  λ©”μ‹μ§€λ¥Ό μ„λ²„λ΅ μ „μ†΅
    - ν΄λΌμ΄μ–ΈνΈλ” SYNμ„ λ³΄λ‚΄κ³  μ„λ²„λ΅λ¶€ν„° SYN/ACK μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” *SYN_SENT* μƒνƒ
  - μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° SYNμ”μ²­μ„ λ°›κ³  ν΄λΌμ΄μ–ΈνΈμ—κ² μ”μ²­μ„ μλ½ν•λ‹¤λ” *ACK*μ™€ SYN flagκ°€ μ„¤μ •λ ν¨ν‚·μ„ λ°μ†΅ν• ν›„ ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤μ‹ ACKμ‘λ‹µμ„ λ³΄λ‚΄κΈ°λ¥Ό κΈ°λ‹¤λ¦Ό
    - μ„λ²„λ” SYNκ³Ό ACK ν”λκ·Έ λΉ„νΈλ¥Ό 1λ΅ μ„¤μ •ν•κ³  λ©”μ‹μ§€λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅
    - μ„λ²„λ” SYN/ACKμ„ λ³΄λ‚΄κ³  *SYN_RCV* μƒνƒ
  - ν΄λΌμ΄μ–ΈνΈλ” λ‹¤μ‹ μ„λ²„μ—κ² ACKμ„ λ³΄λ‚Έ ν›„ μ—°κ²°μ΄ μ΄λ£¨μ–΄μ§€κ³  λ°μ΄ν„°μ ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§
    - ACK ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν•κ³  SYN ν”λκ·Έλ” 0μΌλ΅ μ μ§€
    - μ΄λ• μ„λ²„μ μƒνƒλ” *ESTABLISHED*
  - μ„μ™€ κ°™μ΄ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ ν†µμ‹ μ„ ν•κΈ° μ „ μ‹ λΆ°μ„±μλ” μ—°κ²°μ„ λ§Ίμ–΄ μ¤€λ‹¤λ” κ²ƒμ΄ TCPμ 3-way Handshake

<br><br><br> 

### TCPμ μ—°κ²° ν•΄μ (4-way Handshake)
  - 3-way Handshakeλ” TCPμ μ—°κ²°μ„ μ΄κΈ°ν™” ν•  λ• μ‚¬μ©ν•λ‹¤λ©΄, 4-way Handshakeλ” **μ„Έμ…μ„ μΆ…λ£**ν•κΈ° μ„ν•΄ μν–‰ν•λ” μ μ°¨


![image](https://user-images.githubusercontent.com/50076031/123729785-7b65d300-d8d0-11eb-9b25-fbc356868588.png)

<br>

### 4-way Handshake μ μ°¨ (A: ν΄λΌμ΄μ–ΈνΈ, B: μ„λ²„)
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅ *FIN* ν”λκ·Έλ¥Ό μ „μ†΅
    - FIN ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν•κ³ , μ„μμ μ‹ν€€μ¤ λ²νΈμ™€ ν•¨κ» λ©”μ‹μ§€λ¥Ό μ„λ²„λ΅ μ „μ†΅
    - ACKλ” 0μΌλ΅ μ„¤μ •
  - μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° FINμ„ λ°›κ³  μ‘λ‹µ ν¨ν‚·μΈ ACKμ„ 
    - ν΄λΌμ΄μ–ΈνΈμ μΆ…λ£ μ”μ²­μ„ μμ‹ ν• ν›„ ACK ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν•μ—¬ μΉμΈ λ©”μ‹μ§€λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅
    - ACKμ acknowledgement numberμ„ μμ‹ ν• sequence number + 1λ΅ μ§€μ •
    - μ„λ²„κ°€ μ—°κ²°μ„ μΆ…λ£ν•λ ¤λ©΄ FIN ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν•κ³  ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅
  - ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—μ„ FINμ„ μμ‹ ν• ν›„ ACK ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν•κ³  μ„λ²„μ sequence number + 1λ΅ ACKμ acknowledgement numberμ„ μ„¤μ •ν• ν›„ μ„λ²„λ΅ μ „μ†΅
    - μ„ λ‹¨κ³„λ¥Ό μ™„λ£ν• ν›„ μ„λ²„μ—μ„λ„ ν΄λΌμ΄μ–ΈνΈμΈ΅μΌλ΅μ μ—°κ²°μ΄ μΆ…λ£

<br><br>

### κ° μ©μ–΄ μ„¤λ…

```html
// TCP Header μ• ν”λκ·Έ μ •λ³΄
* SYN(Synchronization): μƒλ€μ— λ€ν• μ ‘μ† μ”μ²­

* ACK(Acknowledgement): μƒλ€μ ν†µμ‹  μ‘λ‹µ

* FIN(Finish): μ—°κ²° ν•΄μ , μ„Έμ… μ—°κ²°μ„ μΆ…λ£μ‹ν‚¬ λ• μ‚¬μ©, λ” μ΄μƒ μ „μ†΅ν•  λ°μ΄ν„°κ°€ μ—†μμ„ μλ―Έν•¨

* SYN_SENT: ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ„λ²„μ—κ² μ‹ν€€μ¤ λ²νΈμ„ μƒμ„±ν•μ—¬ SYN ν¨ν‚·μ— λ‹΄μ•„ λ³΄λƒ„
  - SYN(seq = m)

* SYN_RCV: ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° SYNν¨ν‚·μ„ λ°›μ€ μ„λ²„λ” μμ‹ λ§μ μ‹ν€€μ¤ λ²νΈλ¥Ό μƒμ„±ν•κ³  SYN ν¨ν‚·μ— λ‹΄μ•„ ν΄λΌμ΄μ–ΈνΈμ SYN ν¨ν‚·μ— μλ” μ‹ν€€μ¤ λ²νΈμ— +1μ„ λ”ν• ν›„ ACK ν¨ν‚·μ— λ‹΄μ•„μ„ κ°™μ΄ λ³΄λƒ„
  - SYN(seq = n), ACK(ack = m+1)

* (Client) ESTABLISHED: μ„λ²„λ΅λ¶€ν„° SYN + ACK ν¨ν‚·μ„ λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” ACK ν¨ν‚·μ μ‹ν€€μ¤ λ²νΈλ¥Ό λ³΄κ³  μμ‹ μ΄ λ³΄λ‚Έ μ‹ν€€μ¤ λ²νΈμ™€ μ°¨μ΄κ°€ 1μ„μ„ ν™•μΈν•¨
μ°¨μ΄κ°€ 1μ΄λΌλ©΄ μ λ€λ΅ μ—°κ²°λμ—λ‹¤κ³  νλ‹¨ν•κ³ , μ„λ²„μ SYN ν¨ν‚·μ— μλ” μ‹ν€€μ¤ λ²νΈμ— +1μ„ λ”ν• ν›„ ACK ν¨ν‚·μ— λ‹΄μ•„ λ³΄λƒ„
  - SYN(ack = n+1)

* (Server) ESTABLISHED: ν΄λΌμ΄μ–ΈνΈμ ACK ν¨ν‚·μ„ λ°›κ³  ν¨ν‚·μ— μ΅΄μ¬ν•λ” μ‹ν€€μ¤ λ²νΈκ°€ μ΄μ „μ— λ³΄λ‚Έ SYN ν¨ν‚·μ μ‹ν€€μ¤ λ²νΈ + 1κ³Ό λ™μΌν•λ‹¤λ©΄ μ—°κ²°μ΄ λμ—λ‹¤κ³  νλ‹¨ν•¨
  - ACK(ack = n+1)


// ν¬νΈ(PORT) μƒνƒ μ •λ³΄
* CLOSED: ν¬νΈκ°€ λ‹«ν μƒνƒ

* LISTEN: ν¬νΈκ°€ μ—΄λ¦° μƒνƒλ΅ μ—¬λ…γ„Ή μ”μ²­ λ€κΈ° μ¤‘

* ESTABLISHED: ν¬νΈ μ—°κ²° μƒνƒ
```

### References
  - https://mindnet.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-22%ED%8E%B8-TCP-3-WayHandshake-4-WayHandshake
  - https://afteracademy.com/blog/what-is-a-tcp-3-way-handshake-process
  - https://gmlwjd9405.github.io/2018/09/19/tcp-connection.html
